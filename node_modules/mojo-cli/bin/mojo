#!/usr/bin/env node
var program = require("commander"),
mojoCli     = require(".."),
path        = require("path");

program.
  option("-m, --minify", "minify output").
  option("-p, --port [port]", "http port").
  option("-o, --output [path]", "output file").
  option("-d, --debug", "debug mode").
  option("-s, --serve [path]", "directory to server")

function fixPath (pathname) {
  if (typeof pathname !== "string") return void 0;
  return pathname.substr(0, 1) !== "/" ? path.join(process.cwd(), pathname) : pathname;
}

program.
  command("build [path]").
  description("builds a project").
  action(function (input) {

    var ops = {
      input  : fixPath(input || process.cwd()), 
      output : program.output ? fixPath(program.output) : void 0,
      minify : !!program.minify,
      debug: program.debug,
      port   : Number(process.env.PORT || program.port || 8080),
      serve  : program.serve ? fixPath(program.serve) : void 0
    };

    mojoCli.build(ops, function (err, result) {
      if (err) throw new Error(err);
      if (result && !ops.output) console.log(result);
    })
  });



program.parse(process.argv);
